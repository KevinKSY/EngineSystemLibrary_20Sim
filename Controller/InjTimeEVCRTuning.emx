<?xml version="1.0" encoding="UTF-8"?>
<Document>
  <Icons>
    <Icon size="128" bpp="32" format="png">
<![CDATA[89504e470d0a1a0a0000000d4948445200000080000000800806000000c33e61cb00000006624b474400ff00ff00ffa0bda793000000097048597300000ec400000ec401952b0e1b0000070a49444154789ced9d3f4c1b571cc7bfae40e8826c5a7c8186d425e12ca8c045a44880989232647bcac0140945b2bc65c263c4c8c2e43503f29048284386e82636334562a048949006d92085caaa89e3345870428ee40ed733363edbfc79671b7ebfcf82ee9ddff989fbf8ddefddbddf3d573e9f074397ef1add00a6b1b000c4610188c30210a7c5aed0e5722d01f8b1ce6d61ea403e9fffbd78db65370a70b95c3b00eed6ab514cfdc8e7f3aee26ddb1ec022168b39db1aa66e2c2c2c607979b9ac9c6300e2b000c4610188c302108705200e0b401c1680382c00715800e2b000c4610188c30210870520ce8504e089a4d707ee0188c302108705204ed51941e7c530daf0f66d1f36363c853255cd2110f8827bf776cb3e1f898c573c96a61de1c1831db8dd87329bc89c425a0f90cdb6e3f9f311cccf7743d795427934ea4138dc8b48641c86d15656aff8b3c544225e2c2e0690cdb6cb6a226383b41e2016eb83ae2b989b4b616cec63e1971b0ab5e3cd9b0144a31e0c0ff7616aea7d493d210cccceae969419461b5475e8ff3a3f97d561e421ad0748246e4008035353ef4bba6db7fb10d3d3ef2084517269a886a21c9fbb0e7331a4c6000090c974a0b3f36b4999a21c97fdca6ba128c7329bc554409a0042ec2114ea07f00b2626321818d82f13e13cd8c50b8c7ca409a06949bc78f10d2b2b3fe1d9b3db006e430803aa9ac3e8e8270c0eee9df958d9ac1937583105e31c522f013edf3e6666f6f1e8513bf6f63a118f7f8f44e2069e3ed5100cdec4cccc1f6575cc51c0b84d9919204e4eeec86c22730ae9310060067e838387855ffdc3873e3c7daaa1a3e35708f167cdfa421885fb001c0b388b1401ac1b3a9502bdc1c13d08d18344e246d93ebb6120533fa40c035535075d57b0be6e9f4fca015df3224580fbf7ff060084c3bd585fbf5b72c253292f5ebf1e82ae2b181e3e90f1758c44a45c027cbe7dcccd79313fdf8d70b817427415f659015d3078c077f49a106941e0d4d47b0402fb585d2dbdd6078307151f06318d47ea28a0bbfb3384f87ce6cf73f0d778783e00715800e2b000c46101887321015c2e57ed0f315702ee0188c302108705208e238f83af338d4a8b732aee6201ce49a302e07c3eefc877f32580382c00715800e2700c7049aae53716a36947181f4fa2bbbbfc6969f131eafd8494059040a5fcc65214005e2c2e6e43d392b6c710c290deb65ab00012a974028b050985faf1ead5b16d4fd008580049549add6c186d10c20b5df71544585ded39d7c41927e120d06114e5189a96c4e3c7f14299ddf4f846c102d40973ba5cfdaff1b56001ea442ae53d63b0585f380670986cb61df1781756564ea6ca37537e040b2009bb24d793f21384303036f6b14eadaa0d0b20915a5dbc1006a6a7779beac5572c80442a0579d5de94d6685800495cd52c671e05108705200e0b401c1680382c0071580009c8b8c7dfa8e7043c0cbc2432867e8d1c3e720f401c1680382c00715800e2b000c46101ae084ee5245e4a80665b40b2d9da7315e01e80382c00715800e248bd151c898c17a63ff9fdfbb673dfac59b29b9b3f209d6e4528b489c5c500543567bba2c8695ebefc0de9742b9e3cf9eb526b123126d27b006ba1c858accf767f2cd68770b817d1a8b91c9cdb7d0855cd211af52095f2563d762ae54534ea81aae6f8e44b42ba00421810c2a898fe64ad2f58fcf46b72f21f0066ce5c353637cdb9f5a3a39f24b596712406181e3e80ae2bc8643a4aca33990edb8523342d5990a6daea221b1b1e08619c6b0532a63a8e08d0df6f66be7ef8d055526e6ddfb953de7d5bd2ecee7695ed0380ad2d1faf3ae2008e0870eb5606421888c7dd25e5f1b81b4218e8eddd2fab6365cbacadddb43da655de4c5935d70147046869f90655cd219d6e2d74e986d18674ba15aa9a434bcbb7b23a6ef72166673fdb068356f0170c1e345556cd75c0b1fb007e7f16baae2099344f66326966c7fafdd98a758686cc4b8715ec5958db56b0c8c8c331010606cc6efedd3b6fc9dfbebe4cc53a5630787ac5702bf8b37bb70e73391c13a0b3f36bc970d01afed57a37cec44406baae606bcb07e024f89b98a82c0e73711cbd15ac6947d0750589440f745d81aae66ad61919f908218c42d0b7b6761342181819e1e0cf091c15c0efff1700a0ebe6af3910f852b38ef94e9d2344a31e24123d88463dd0b4235e43d8211c15c0e733bb6d2b6fdeef2f1ffed96105839638d636231f47f302dceec3925bbe671dc299c1a079f239f8731697dd2c1a97cbb503e06e2c16ab5ad9a957985f94666b4f33b1b0b080e5e565e4f3f9927f10cf07200e0b401c1680382c00712e2540b3055ccdd69eab00f700c4610188c302108705200e0b401c1680382c00715800e2b000c4610188c302108705200e0b401c1680382c00715800e2b000c4610188c302108705204ed5d4b0a5a5a57ab5837198eded6ddbf2aaa9610eb7896900a753c36c0560e8c03100715800e2b000c4f90f5baa32ba2db78b6e0000000049454e44ae426082]]>
     </Icon>
  </Icons>
  <Model version="4.5" build="4.5.1.5561">
    <Sidops>
<![CDATA[Controller2 568 224 description '<Information>
 <Description>
    <Version>4.5</Version>
<IsMainModel>1</IsMainModel>
  <KeepParameterValues>False</KeepParameterValues>
    <LibraryPath>Controller\InjTimeEVCRTuning.emx</LibraryPath>
  <TimeStamp>2015-9-1 09:34:51</TimeStamp>
</Description>
</Information>'; type 'Controller-PI'  ports   signal in V_cyl;   signal out output1; "Exh_VV_dur"   signal in p_cyl;   signal boolean in Exh_open;   signal in T_cyl;   signal in p_max;   signal out output2; "injection timing"   signal in BSFC_MV;   signal in Power; end; icon bg bottom  figures   rectangle 536 192 600 256 fill 12632256;   text 'PI' 582.4 223 color 16711680 fill 12632256 18 bold;   text 'SP' 548.8 206.9 color 16711680 fill 12632256 14;   text 'MV' 550.9 237.9 color 16711680 fill 12632256 14;  terminals   V_cyl 536 240 fixed;   output1 600 224 fixed; end; implementation eq// Created by C. Kleijn, 22 Sep 1999parameters		real K_exh = 0.002 {};		// Proportional gain	real Ti_exh = 0.66 {s};	// Integral time constant (Ti > 0).	real K_inj = 0.008 {};		// Proportional gain	real Ti_inj = 0.66 {s};	// Integral time constant (Ti > 0).		real K_p_max = 0.5 {};		// Proportional gain	real Ti_p_max = 0.66 {s};	// Integral time constant (Ti > 0).		real minimum_exh = 0.5;	real maximum_exh = 1.9;		real minimum_inj = -8;	real maximum_inj = 10;	real minimum_p_max = 50;	real maximum_p_max = 200;	real global dm_exh[2];	real global BSFC[2];	real global PL[2];	integer global CASE;	integer global ncyl;	real kappa_coeff[6] = [1.37144037145225;0.00116555513968688;2.97699820341333e-08;1.29300760141299e-05;2.48361828485645e-09;-1.84327235025469e-14];	real kappa_Tw_corr = 1.34637301285974e-05;	real delta_p_comb_ref = 40;	real global Diam,slag,Veps;	real Power_max = 25040e3;/*	real p_max_ref[11] = [			179.0952202;			172.5930202;			185.7842853;			191.5650216;			190.4602179;			186.5752502;			184.6077701;			196.1703422;			184.1210768;			157.1987814;			127.9522214];*/			variables	real error;	real hidden uP_exh,uI_exh, uP_inj, uI_inj, uP_p_max, uI_p_max;	boolean reset;	real kappa, p_comp, p_comp_ref, delta_p_comb, Vc, CR, SP_BSFC, SP;	real p_max_ref;	boolean hidden found;	integer hidden i, n;	real PL_m;initialequations	reset = false;	Vc = pi*Diam^2/4*slag/(Veps-1);	p_comp = 120e5;	p_max_ref = 160;	SP = dm_exh[CASE];code	SP_BSFC = BSFC[CASE];	// First find the right BSFC and p_max_ref for corresponding power load 	PL_m = Power / Power_max;	i = 1; n = rows(PL); found = false;	while (i <= n and not found) do		if PL_m > PL[i] then			found = true;			if i == 1 then			// Use the first point in case the input is above upper bound				SP_BSFC = BSFC[i];			else				SP_BSFC = BSFC[i-1] + (PL_m - PL[i-1]) * (BSFC[i] - BSFC[i-1]) / (PL[i] - PL[i-1]);			end;		else			if i == n then 		// Use the last point in case the input is below lower bound				found = true;				SP_BSFC = BSFC[i];			end;		end;		i = i + 1;	end;		if Exh_open == true and reset == false then		reset = true;	else if Exh_open == false and reset == true then				reset = false;				CR = V_cyl / Vc;				kappa = kappa_coeff[1] + kappa_coeff[2]*CR + kappa_coeff[3]*p_cyl/1e5 + kappa_coeff[4]*CR^2 + kappa_coeff[5]*CR*p_cyl/1e5 + kappa_coeff[6]*(p_cyl/1e5)^2;				kappa = kappa + kappa_Tw_corr*(900-T_cyl);				p_comp = p_cyl*(V_cyl / Vc)^kappa;			end;	end;	error = BSFC_MV - SP_BSFC;	uP_p_max = K_p_max * error;	uI_p_max = int(error * K_p_max / Ti_p_max,100);	p_max_ref = limit(uP_p_max + uI_p_max, minimum_p_max, maximum_p_max);	delta_p_comb = (p_max - p_comp)/1e5;	p_comp_ref = p_max_ref - delta_p_comb;	error =  p_comp/1e5 - p_comp_ref;	uP_exh = K_exh * error;	uI_exh = int (error * K_exh / Ti_exh, 1.0);	output1 = limit(uP_exh + uI_exh,minimum_exh,maximum_exh);                                     		error = delta_p_comb - delta_p_comb_ref;	uP_inj = K_inj * error;	uI_inj = int (error * K_inj / Ti_inj, 0);	output2 = limit(uP_inj + uI_inj,minimum_inj,maximum_inj);                                     	implementation_end;]]>
    </Sidops>
  </Model>
</Document>
